{% extends 'base.html' %}
{% load static %}

{% block title %}Welcome to AuroraMart{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/personalization.css' %}">
<script src="https://unpkg.com/lucide@latest"></script>
{% endblock %}

{% block content %}
<div class="welcome-page">
    <div class="welcome-card">
        <div class="welcome-header">
            <div class="welcome-icon">
                <i data-lucide="shopping-bag"></i>
            </div>
            <h1>Welcome to AuroraMart!</h1>
            <p class="welcome-subtitle">Help us personalize your shopping experience</p>
            <p class="welcome-description">Just a few quick questions to get started (completely optional)</p>
        </div>

        <form method="POST" class="personalization-form">
            {% csrf_token %}

            <!-- Age Range Selection -->
            <div class="form-group">
                <label class="form-label">
                    <i data-lucide="calendar"></i>
                    What's your age range?
                </label>
                <div class="tile-group" data-field="age_range">
                    <input type="hidden" name="age_range" id="id_age_range" value="">
                    <button type="button" class="tile" data-value="18-24">
                        <i data-lucide="graduation-cap"></i>
                        <span>18-24</span>
                    </button>
                    <button type="button" class="tile" data-value="25-34">
                        <i data-lucide="briefcase"></i>
                        <span>25-34</span>
                    </button>
                    <button type="button" class="tile" data-value="35-44">
                        <i data-lucide="users"></i>
                        <span>35-44</span>
                    </button>
                    <button type="button" class="tile" data-value="45-54">
                        <i data-lucide="home"></i>
                        <span>45-54</span>
                    </button>
                    <button type="button" class="tile" data-value="55-64">
                        <i data-lucide="sun"></i>
                        <span>55-64</span>
                    </button>
                    <button type="button" class="tile" data-value="65+">
                        <i data-lucide="heart"></i>
                        <span>65+</span>
                    </button>
                </div>
            </div>

            <!-- Gender Selection -->
            <div class="form-group">
                <label class="form-label">
                    <i data-lucide="users"></i>
                    How do you identify?
                </label>
                <div class="tile-group tile-group-large" data-field="gender">
                    <input type="hidden" name="gender" id="id_gender" value="">
                    <button type="button" class="tile tile-large" data-value="Male">
                        <i data-lucide="user"></i>
                        <span>Male</span>
                    </button>
                    <button type="button" class="tile tile-large" data-value="Female">
                        <i data-lucide="user-round"></i>
                        <span>Female</span>
                    </button>
                    <button type="button" class="tile tile-large" data-value="Other">
                        <i data-lucide="users-round"></i>
                        <span>Other</span>
                    </button>
                </div>
            </div>

            <!-- Shopping Interest -->
            <div class="form-group">
                <label class="form-label">
                    <i data-lucide="shopping-bag"></i>
                    What brings you here today?
                </label>
                <div class="tile-group tile-group-interests" data-field="shopping_interest">
                    <input type="hidden" name="shopping_interest" id="id_shopping_interest" value="">
                    <button type="button" class="tile" data-value="Electronics">
                        <i data-lucide="laptop"></i>
                        <span>Electronics</span>
                    </button>
                    <button type="button" class="tile" data-value="Fashion - Men">
                        <i data-lucide="shirt"></i>
                        <span>Men's Fashion</span>
                    </button>
                    <button type="button" class="tile" data-value="Fashion - Women">
                        <i data-lucide="sparkles"></i>
                        <span>Women's Fashion</span>
                    </button>
                    <button type="button" class="tile" data-value="Home & Kitchen">
                        <i data-lucide="home"></i>
                        <span>Home & Kitchen</span>
                    </button>
                    <button type="button" class="tile" data-value="Beauty & Personal Care">
                        <i data-lucide="heart"></i>
                        <span>Beauty</span>
                    </button>
                    <button type="button" class="tile" data-value="Sports & Outdoors">
                        <i data-lucide="dumbbell"></i>
                        <span>Sports</span>
                    </button>
                    <button type="button" class="tile" data-value="Books">
                        <i data-lucide="book-open"></i>
                        <span>Books</span>
                    </button>
                    <button type="button" class="tile" data-value="Pet Supplies">
                        <i data-lucide="paw-print"></i>
                        <span>Pets</span>
                    </button>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <a href="{% url 'home:index' %}" class="btn-skip">
                    <i data-lucide="skip-forward"></i>
                    Skip for now
                </a>
                <button type="submit" class="btn-continue">
                    <span>Continue</span>
                    <i data-lucide="arrow-right"></i>
                </button>
            </div>
        </form>

        <div class="welcome-footer">
            <p>
                <i data-lucide="lock"></i>
                Your preferences help us show you relevant products. You can change these anytime in your profile.
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize Lucide icons
        lucide.createIcons();

        const form = document.querySelector('.personalization-form');

        // Tile selection functionality
        const tileGroups = document.querySelectorAll('.tile-group');
        tileGroups.forEach(group => {
            const fieldName = group.dataset.field;
            const hiddenInput = document.getElementById('id_' + fieldName);
            const tiles = group.querySelectorAll('.tile');

            tiles.forEach(tile => {
                tile.addEventListener('click', function (e) {
                    e.preventDefault();

                    // Toggle selection
                    const wasSelected = this.classList.contains('selected');

                    // Remove selected class from all tiles in this group
                    tiles.forEach(t => t.classList.remove('selected'));

                    if (!wasSelected) {
                        // Select this tile
                        this.classList.add('selected');
                        hiddenInput.value = this.dataset.value;

                        // Add animation
                        this.style.animation = 'none';
                        setTimeout(() => {
                            this.style.animation = 'pulse 0.3s ease';
                        }, 10);
                    } else {
                        // Deselect (optional fields can be empty)
                        hiddenInput.value = '';
                    }
                });
            });
        });

        // Loading state on submit
        form.addEventListener('submit', function () {
            const submitBtn = this.querySelector('.btn-continue');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span>Saving...</span><i data-lucide="loader-2" class="spinning"></i>';
            lucide.createIcons();
        });
    });
</script>
{% endblock %}
