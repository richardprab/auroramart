{% if user.is_authenticated %}
<!-- Chat FAB Button -->
<div id="chat-fab" class="fixed bottom-6 right-6 z-40">
    <button type="button" id="chat-fab-button"
        class="bg-blue-600 hover:bg-blue-700 text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg transition-all relative group">
        <i data-lucide="message-circle" class="w-6 h-6"></i>
        <span id="chat-badge" class="hidden absolute -top-1 -right-1 bg-red-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">
            0
        </span>
        <span class="absolute right-16 bg-gray-900 text-white text-sm px-3 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
            Chat with Support
        </span>
    </button>
</div>

<!-- Chat Window -->
<div id="chat-window" class="hidden fixed bottom-24 right-6 w-96 bg-white rounded-lg shadow-2xl z-50 flex flex-col" style="height: 500px; max-height: calc(100vh - 150px);">
    <!-- Header -->
    <div class="bg-blue-600 text-white p-4 rounded-t-lg flex items-center justify-between">
        <div class="flex items-center gap-2">
            <i data-lucide="headphones" class="w-5 h-5"></i>
            <h3 class="font-semibold">Support Chat</h3>
        </div>
        <div class="flex items-center gap-2">
            <button type="button" id="chat-minimize-btn" class="hover:bg-blue-700 p-1 rounded transition">
                <i data-lucide="minus" class="w-5 h-5"></i>
            </button>
            <button type="button" id="chat-close-btn" class="hover:bg-blue-700 p-1 rounded transition">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>
    </div>

    <!-- Session Selector (if multiple sessions) -->
    <div id="session-selector" class="hidden border-b bg-gray-50 p-2">
        <select id="session-select" onchange="ChatWidget.switchSession(this.value)" 
            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">Select a conversation...</option>
        </select>
    </div>

    <!-- Messages Container -->
    <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50">
        <div class="text-center text-gray-500 py-8">
            <i data-lucide="message-square" class="w-12 h-12 mx-auto mb-2 text-gray-400"></i>
            <p>Start a conversation with our support team</p>
        </div>
    </div>

    <!-- Input Area -->
    <div class="p-4 border-t bg-white rounded-b-lg">
        <form id="chat-form" onsubmit="ChatWidget.sendMessage(event)" class="flex gap-2">
            <input type="text" id="chat-input" placeholder="Type your message..." 
                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition flex items-center gap-2">
                <i data-lucide="send" class="w-4 h-4"></i>
            </button>
        </form>
    </div>
</div>
{% endif %}
